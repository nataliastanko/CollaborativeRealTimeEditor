//= require jquery
//= require jquery_ujs
//= require_self

jQuery(document).ready(function($){

  $('.addQuestion').on('click', addQuestionField);

  $(document).on('click', '.removeQuestion', removeField); /* live */
  $(document).on('click', '.removeExistingQuestion', removeExistingField);
  
})

function removeField(event){
  event.preventDefault();
  $(this).parents('.fieldQuestion').fadeOut('fast',function(){$(this).remove()})
}

function removeExistingField(event){
  event.preventDefault();
  $(this).parents('.fieldQuestion').fadeOut('fast',function(){$(this).remove()})
}

function addQuestionField(event){
  event.preventDefault();
  
  var fields,i,template,reg;
  
  // get fields from languages
  fields = $('fieldset.questions li.fieldQuestion');
  i = parseInt($('fieldset.questions').attr('rel') || fields.length)
  $('fieldset.questions').attr({'rel':i+1})
  //if (i == 0)  {
    template = '<li class="fieldQuestion clearfix" id="question-row-'+i+'">' + $('fieldset.questions .question-template').html() + '</li>';

  //}else {
  //  template = '<li class="fieldQuestion clearfix" id="question-row-'+i+'">' + fields.first().html() + '</li>';
  //}
  
  reg = new RegExp("_" + (i-1) + "_", "g");  
  template = template.replace(reg, "_" + (i) + "_");
  reg = new RegExp('\\[' + (i-1) + '\\]', "g");  
  template = template.replace(reg, "[" + (i) + "]");
  $('fieldset.questions ol').append(template);
  var last_field = $('fieldset.questions li.fieldQuestion').last();
  last_field.append('<a href="#" class="removeQuestion">x</a>').hide().slideDown()
  last_field.find('input').val('')
}
